#!/bin/bash


 if [ $# -ne 5 ]  ##if site is not included

  then
        tarchive=$1
        proj=$2
        mail_user=$3
        tarchive_location=$4
  else
       site=$1
       tarchive=$2
       proj=$3
       mail_user=$4
       tarchive_location=$5
  fi

if [ -z "$tarchive" -o -z "$proj" -o -z "$mail_user" ]
then
echo "Usage: $0 <tarchive> <project-name> <mail_user>"
exit 1
fi


tempdir=$TMPDIR/load_tarchive_db.$$
mkdir -p $tempdir


##Set the tarchive_location to a proper location
if [ -z $tarchive_location -o $tarchive_location=undef ]

then
  tarchive_location=/data/$proj/data/tarchive/
fi


# copy the tarchive from the study workstation to here
if
    cp $tarchive_location/$tarchive $tempdir/
# if the copy succeeded
then

# process the tarchive
uploadNeuroDB/tarchiveLoader -globLocation -profile prod $tempdir/`basename $tarchive`

# if the copy failed
else

# email the user
echo "Subject: SCP TARCHIVE FAILURE\nFailed to scp ${site} ${tarchive}"  | mail $mail_user

fi

rm -fr $tempdir
exit 0
